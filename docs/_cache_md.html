<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sphyrnidae Common Library: Caching</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Sphyrnidae Common Library
   &#160;<span id="projectnumber">2.0.1</span>
   </div>
   <div id="projectbrief">Shared Utilities/Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_cache_md.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Caching </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_C__Users_dougb_Desktop_Sphyrnidae_New_Common_Common_Cache_Cache"></a> </p>
<h1><a class="anchor" id="CacheOverviewMd"></a>
Overview</h1>
<p>Caching allows you to quickly retrieve saved data/objects instead of always having to lookup data. Data/objects from cache are NOT real-time objects, so please be aware of this if you are using frequently-changing data. Caching is most useful for slowly changing data (or best for static-data), as this avoids a typically to a database or other data source.</p>
<p>The <a class="el" href="interface_sphyrnidae_1_1_common_1_1_cache_1_1_i_cache.html">ICache</a> interface has the following methods:</p><ol type="1">
<li>Get: Retrieves an item from cache via output variable (returns true/false on if it found the object)</li>
<li>Set: Saves an item into cache</li>
<li>Get&lt;T&gt;: If the item exists in cache, immediately returns that item. Otherwise, will execute your function to get the item, store it into cache, and then return the item.</li>
<li>GetAsync: Same as Get&lt;T&gt;, but is asynchronous allowing your function call to be asynchronous.</li>
</ol>
<p>Interface: <a class="el" href="interface_sphyrnidae_1_1_common_1_1_cache_1_1_i_cache.html">ICache</a></p>
<p>Mock: <a class="el" href="class_sphyrnidae_1_1_common_1_1_cache_1_1_cache_none.html">CacheNone</a></p>
<p>Implementations:</p><ol type="1">
<li><a class="el" href="class_sphyrnidae_1_1_common_1_1_cache_1_1_cache_local.html">CacheLocal</a>: Uses local/memory cache only. If you have multiple web servers, they will each have their own cache (which could contain different objects based on when they were set with real-time data)</li>
<li><a class="el" href="class_sphyrnidae_1_1_common_1_1_cache_1_1_cache_distributed.html">CacheDistributed</a>: Distributed caching only (eg. <a href="https://redis.io/" target="blank">Redis</a>). All calls will go to an external caching system. Eg. Does have the overhead of a network call, but all servers share the exact same cache.</li>
<li><a class="el" href="class_sphyrnidae_1_1_common_1_1_cache_1_1_cache_local_and_distributed.html">CacheLocalAndDistributed</a>: This will use both local and distributed, based on the <a class="el" href="_environment_md.html">Environmental</a> settings of Cache.Distributed and Cache:Local. If the setting is found locally, it will use that. Otherwise, it will use the distributed cache.</li>
</ol>
<p>Wrapper: <a class="el" href="class_sphyrnidae_1_1_common_1_1_cache_1_1_caching.html">Caching</a> - currently contains no additional capability, you can generally just directly call the interface methods.</p>
<h1><a class="anchor" id="CacheInvalidationMd"></a>
Cache Invalidation</h1>
<p>If an object has been updated after it was placed in cache, the cached instance will no longer be accurate. In some business scenarios, that is acceptable. However, you should utilize the following techniques to help ensure the cached object is accurate:</p><ol type="1">
<li>Expiration: All of the implementations have an "Options" property. You can update the <a class="el" href="class_sphyrnidae_1_1_common_1_1_cache_1_1_models_1_1_cache_options.html#a48b10e3ff776741d3665d3645b57da07">Seconds</a> property on the Options object to specify how long this should be cached for (Default = 1200; 20 minutes). Note there are helper static properties on the <a class="el" href="class_sphyrnidae_1_1_common_1_1_cache_1_1_models_1_1_cache_options.html">CacheOptions</a> object (You can use these, or specify your own value): <a class="el" href="class_sphyrnidae_1_1_common_1_1_cache_1_1_models_1_1_cache_options.html#a49178224b82c206f1541573ffd8e0560">Minute</a>, <a class="el" href="class_sphyrnidae_1_1_common_1_1_cache_1_1_models_1_1_cache_options.html#a81676f18e737825bead8d97c9d1a6591">Hour</a>, <a class="el" href="class_sphyrnidae_1_1_common_1_1_cache_1_1_models_1_1_cache_options.html#a17f125c5d8bc38c3edc019f3594b4d4c">Day</a>, <a class="el" href="class_sphyrnidae_1_1_common_1_1_cache_1_1_models_1_1_cache_options.html#a15ca22f156a24e3f2d248defaac6048b">Month</a>, <a class="el" href="class_sphyrnidae_1_1_common_1_1_cache_1_1_models_1_1_cache_options.html#af59341bf7ca0b36ad7f55fd6369da1f1">Year</a></li>
<li><a class="el" href="class_sphyrnidae_1_1_common_1_1_cache_1_1_models_1_1_cache_options.html#aa0d67ec4dd0e8d200db91512f9237ee2">Priority</a>: If you are heavily caching, you could run into memory problems and items will be dropped from the cache. You should ensure your most-used, costliest, and/or static cache items have a higher priority than your least-used, cheap, and/or near real-time cache items.</li>
<li>Remove: This is a method on the <a class="el" href="interface_sphyrnidae_1_1_common_1_1_cache_1_1_i_cache.html">ICache</a> interface which will remove the item from cache. This can be done whenever you know a cached object is no longer valid.</li>
</ol>
<p>For the <a class="el" href="class_sphyrnidae_1_1_common_1_1_cache_1_1_cache_local_and_distributed.html">CacheLocalAndDistributed</a> implementation, the Remove method will not only remove it from the local cache that happens to be running, but also distributed cache, AND will send out a <a class="el" href="_signal_r_md.html">SignalR</a> request to other servers to also clear their local cache. The <a class="el" href="_api_md.html">API</a> default setup for SignalR is to subscribe and handle these caching removal requests based on the <a class="el" href="_environment_md.html">Environmental</a> variable: URL.Hub.Cache</p>
<h1><a class="anchor" id="CacheWhereUsedMd"></a>
Where Used</h1>
<table class="doxtable">
<tr>
<th>Class </th><th>Key </th><th>Seconds </th><th>Description </th></tr>
<tr>
<td><a class="el" href="class_sphyrnidae_1_1_common_1_1_api_1_1_middleware_1_1_authentication_middleware.html">AuthenticationMiddleware</a> </td><td>$"ApiAuth_{app.Name}_{application}_{token}" </td><td>30 </td><td>Specifies if an application is authenticated for API&lt;=&gt;API communication </td></tr>
<tr>
<td><a class="el" href="class_sphyrnidae_1_1_common_1_1_encryption_1_1_key_manager_1_1_encryption_key_manager.html">EncryptionKeyManager</a> </td><td>EncryptionKeys </td><td>Default </td><td>Retrieves information related to encryption keys </td></tr>
<tr>
<td><a class="el" href="interface_sphyrnidae_1_1_common_1_1_feature_toggle_1_1_interfaces_1_1_i_feature_toggle_settings.html">IFeatureToggleSettings</a> </td><td>FeatureToggleSettings </td><td>600 </td><td>Stores feature toggle settings for the application </td></tr>
<tr>
<td><a class="el" href="interface_sphyrnidae_1_1_common_1_1_user_preference_1_1_interfaces_1_1_i_user_preference_settings.html">IUserPreferenceSettings</a> </td><td>UserPreferenceSettings </td><td>1200 </td><td>Stores user preferences for a given user </td></tr>
<tr>
<td><a class="el" href="interface_sphyrnidae_1_1_common_1_1_variable_1_1_interfaces_1_1_i_variable_settings.html">IVariableSettings</a> </td><td>VariableSettings </td><td>Minute </td><td>Stores variables/configurations for the application </td></tr>
<tr>
<td><a class="el" href="interface_sphyrnidae_1_1_common_1_1_logging_1_1_interfaces_1_1_i_logger_configuration.html">ILoggerConfiguration</a> </td><td>Logging_Enabled_Types </td><td>1200 </td><td>Which types of loggers are enabled </td></tr>
<tr>
<td><a class="el" href="interface_sphyrnidae_1_1_common_1_1_logging_1_1_interfaces_1_1_i_logger_configuration.html">ILoggerConfiguration</a> </td><td>Logging_Includes </td><td>1200 </td><td>Optional attributes to log for a given type </td></tr>
<tr>
<td><a class="el" href="interface_sphyrnidae_1_1_common_1_1_logging_1_1_interfaces_1_1_i_logger_configuration.html">ILoggerConfiguration</a> </td><td>Logging_Enabled_Loggers </td><td>1200 </td><td>Which loggers are enabled </td></tr>
<tr>
<td><a class="el" href="interface_sphyrnidae_1_1_common_1_1_logging_1_1_interfaces_1_1_i_logger_configuration.html">ILoggerConfiguration</a> </td><td>$"Logging_Enabled_{name}_Types" </td><td>1200 </td><td>For a given logger, what types are enabled for that logger </td></tr>
<tr>
<td><a class="el" href="interface_sphyrnidae_1_1_common_1_1_logging_1_1_interfaces_1_1_i_logger_configuration.html">ILoggerConfiguration</a> </td><td>Logging_HideKeys </td><td>1200 </td><td>Listing of logging keys where the values will be obfuscated in the log </td></tr>
</table>
<h1><a class="anchor" id="CacheExampleMd"></a>
Examples</h1>
<pre>
    // Injected: ICache cache
    const string Key = "MyKey";

    cache.Options.Seconds = CacheOptions.Day;
    cache.Options.Priority = CacheItemPriority.NeverRemove;
    if (!cache.Get(Key, out string foo))
        cache.Set(Key, "MyValue");

    cache.Options.Seconds = CacheOptions.Hour;
    cache.Options.Priority = CacheItemPriority.Low;
    foo = cache.Get(Key, () =&gt; "MyValue");

    foo = await Caching.GetAsync(cache, key, async () =&gt; await MyAsyncMethod());

    var ex = Caching.Remove(cache, key);
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
